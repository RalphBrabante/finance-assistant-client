<div class="container mt-4">
  <h2 class="mb-3">Expenses</h2>
  <!-- Responsive wrapper -->
  <div class="mt-2 mb-2 ps-0 d-flex align-items-center">
    <app-create-expense-modal (onSubmitSuccess)="fetchData()" />
    <div class="pageSizeField d-flex align-items-center">
      <label for="">Rows</label>
      <select
        class="form-select ms-1"
        id="pageSizeSelect"
        (change)="changePageSize($event)"
        [value]="pageSize()"
      >
        <option value="5" selected>5</option>
        <option value="10" selected>10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-hover table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th scope="col">Purpose</th>
          <th scope="col">Cost</th>
          <th scope="col">Status</th>
          <th scope="col">Date Settled</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @if(isLoading()){
        <tr>
          <td
            colspan="7"
            class="text-center"
            style="background-color: rgba(255, 234, 0, 0.303)"
          >
            No data found
          </td>
        </tr>
        } @if(!expenses().length && !isLoading()){
        <tr>
          <td
            colspan="7"
            class="text-center"
            style="background-color: rgba(255, 234, 0, 0.303)"
          >
            No data found
          </td>
        </tr>

        }@else{ @for (expense of expenses(); track $index) {
        <tr [ngClass]="'expenseItem' + expense.id">
          <th scope="row" class="expenseId">
            {{ expense.id }}
          </th>
          <td class="expenseName">{{ expense.name }}</td>
          <td class="expensePurpose">{{ expense.purpose }}</td>
          <td class="text-right expenseCost">
            {{ expense.cost | currency : "PHP" }}
          </td>
          <td class="text-center expenseStatus">
            <span
              class="badge rounded-pill"
              [class.text-bg-warning]="expense.status == 'PEND'"
              [class.text-bg-success]="expense.status == 'PAID'"
              >{{ expense.status }}
            </span>
          </td>
          <td class="expenseDateSettled">{{ expense.dateSettled | date }}</td>
          <td>
            @if(expense.id){ @if(expense.status !== 'PAID'){
            <button
              class="btn btn-sm btn-success me-2"
              (click)="markAsPaid(expense.id)"
            >
              Pay
            </button>
            }
            <button
              class="btn btn-sm btn-danger"
              (click)="confirmDelete(expense.id)"
            >
              Delete
            </button>
            }
          </td>
        </tr>
        }}
      </tbody>
    </table>

    <!-- Bootstrap Pagination -->
    <nav aria-label="Table pagination">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="page() === 1">
          <a
            class="page-link"
            href="#"
            (click)="changePage(page() - 1); $event.preventDefault()"
            >Previous</a
          >
        </li>

        <li
          class="page-item"
          *ngFor="let p of [].constructor(totalPages); let i = index"
          [class.active]="page() === i + 1"
        >
          <a
            class="page-link"
            href="#"
            (click)="changePage(i + 1); $event.preventDefault()"
            >{{ i + 1 }}</a
          >
        </li>

        <li class="page-item" [class.disabled]="page() === totalPages">
          <a
            class="page-link"
            href="#"
            (click)="changePage(page() + 1); $event.preventDefault()"
            >Next</a
          >
        </li>
      </ul>
    </nav>
  </div>
</div>
